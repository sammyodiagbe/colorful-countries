import Head from "next/head";
import styles from "../styles/Home.module.css";
import { FaSearch } from "react-icons/fa";
import { useState, useRef } from "react";
import axios from "axios";
import Country from "../layouts/country";
import Layout from "../layouts/Layout";
import { FaChevronDown } from "react-icons/fa";

export default function Home({ country_data }) {
  const [filterValue, setFilterValue] = useState("");
  const [showMenu, setShowMenu] = useState(false);
  const renderCountries = country_data.map((country, index) => {
    return <Country key={index} data={country} />;
  });

  const inputRef = useRef(null);
  const filterCountries = (e) => {
    e.preventDefault();
    const { filter } = e.target.dataset;
    inputRef.current.setAttribute("placeholder", filter);
    setShowMenu(false);
  };

  return (
    <Layout>
      <div className={styles.container}>
        <Head>
          <title>Colorful Countries</title>
          <meta name="description" content="Generated by create next app" />
          <meta name="author" content="Odiagbe Samson Osaro" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
        <div className={styles.inputAndFilterContainer}>
          <div className={styles.inputContainer}>
            <FaSearch className={styles.buttonIcon} />
            <input type="text" placeholder="Search for a country" />
          </div>

          {/* build custom select */}
          <div className={styles.filter}>
            <div className={styles.filterContainer}>
              <div className={styles.valueContainer}>
                <input
                  type="text"
                  placeholder="Filter by Region"
                  className={styles.value}
                  readOnly
                  onFocus={() => setShowMenu(true)}
                  ref={inputRef}
                />
                <FaChevronDown className={styles.icon} />
              </div>
              {showMenu && (
                <div className={styles.options}>
                  <button
                    className={styles.option}
                    onClick={filterCountries}
                    data-filter="Europe"
                  >
                    Europe
                  </button>
                  <button
                    className={styles.option}
                    onClick={filterCountries}
                    data-filter="Africa"
                  >
                    Africa
                  </button>
                  <button
                    className={styles.option}
                    onClick={filterCountries}
                    data-filter="America"
                  >
                    America
                  </button>
                  <button
                    className={styles.option}
                    onClick={filterCountries}
                    data-filter="Asia"
                  >
                    Asia
                  </button>
                  <button
                    className={styles.option}
                    onClick={filterCountries}
                    data-filter="Oceania"
                  >
                    Oceania
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
        <div className={styles.countriesContainer}>{renderCountries}</div>
      </div>
    </Layout>
  );
}

export async function getServerSideProps(context) {
  let country_data;
  try {
    let res = await axios.get("https://restcountries.eu/rest/v2/all");
    country_data = res.data;
  } catch (err) {
    console.log("something broke, ", err);
  }

  return {
    props: { country_data },
  };
}
